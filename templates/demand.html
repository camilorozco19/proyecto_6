{% extends "base.html" %}
{% block content %}
<div class="card shadow-sm">
  <div class="card-body">
    <h4 class="mb-3">ğŸ“Š AnÃ¡lisis de Demanda (ReseÃ±as)</h4>

    {% if error %}
      <div class="alert alert-warning">{{ error }}</div>
    {% endif %}

    {% if wordcloud %}
      <div class="row">
        <!-- Nube de palabras -->
        <div class="col-md-6">
          <h6>â˜ï¸ Nube de Palabras</h6>
          <img src="data:image/png;base64,{{ wordcloud }}" class="img-fluid rounded shadow-sm" alt="Wordcloud">
        </div>

        <!-- Sentimiento y TÃ³picos -->
        <div class="col-md-6">
          <h6>ğŸ˜Š Sentimiento Promedio</h6>
          <p class="fw-bold">
            {% if avg_sentiment > 0.1 %}
              Positivo ({{ avg_sentiment|round(2) }})
            {% elif avg_sentiment < -0.1 %}
              Negativo ({{ avg_sentiment|round(2) }})
            {% else %}
              Neutral ({{ avg_sentiment|round(2) }})
            {% endif %}
          </p>

          <h6>ğŸ“Œ TÃ³picos principales</h6>
          <ul>
            {% for t in topics %}
              <li><b>Tema {{ t.topic }}</b>: {{ t.words|join(', ') }}</li>
            {% endfor %}
          </ul>
        </div>
      </div>

      <!-- Series temporales -->
      <h6 class="mt-3">ğŸ“… EvoluciÃ³n de ReseÃ±as (por mes)</h6>
      <div class="row">
        {% for k,v in time_series.items() %}
          <div class="col-md-4 col-sm-6 mb-2">
            <span class="badge bg-light text-dark w-100 text-start shadow-sm">
              {{ k }} : {{ v }}
            </span>
          </div>
        {% endfor %}
      </div>

      <!-- ConclusiÃ³n tipo IA -->
      <div class="alert alert-info mt-4 shadow-sm">
        <h6>ğŸ¤– ConclusiÃ³n y RecomendaciÃ³n</h6>
        <p id="recommendation-demand"></p>
      </div>
    {% endif %}
  </div>
</div>

<!-- Efecto mÃ¡quina de escribir -->
<script>
document.addEventListener("DOMContentLoaded", function() {
  const text = `{% if avg_sentiment > 0.1 %}
    En general, los clientes muestran una percepciÃ³n positiva hacia los negocios,
    destacando palabras como â€œbuenoâ€, â€œexcelenteâ€, â€œservicioâ€, â€œrestauranteâ€.
    Se recomienda mantener la calidad en el servicio y reforzar los aspectos que generan satisfacciÃ³n.
  {% elif avg_sentiment < -0.1 %}
    El anÃ¡lisis refleja una tendencia negativa en las reseÃ±as, con quejas frecuentes en los tÃ³picos detectados.
    Se recomienda investigar estos problemas y plantear mejoras para recuperar la confianza del cliente.
  {% else %}
    El sentimiento es neutral, lo que indica que la experiencia del cliente es aceptable pero sin destacar.
    Se recomienda implementar acciones diferenciadoras para generar mayor fidelidad.
  {% endif %}`;
  
  const el = document.getElementById("recommendation-demand");
  let i = 0;
  function typeWriter() {
    if (i < text.length) {
      el.innerHTML += text.charAt(i);
      i++;
      setTimeout(typeWriter, 30); // velocidad
    }
  }
  typeWriter();
});
</script>

<style>
#recommendation-demand {
  font-family: monospace;
  white-space: pre-wrap;
  border-right: 2px solid #333;
  animation: blink 0.8s infinite;
}
@keyframes blink {
  0%, 50% { border-color: transparent; }
  51%, 100% { border-color: #333; }
}
</style>
{% endblock %}
